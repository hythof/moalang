compile_to_js string opt(string)

compile_to_js src =
  tree <- parse(src)
  build(tree)

ast|
  int int
  op2 op string, left ast, right ast

parser:
  src string
  pos int
  parse_top = parse_exp
  parse_value = parse_int
  parse_exp =
    v <- parse_unit
    parse_op2(v).or(v)
  parse_op2 l =
    op <- read_op
    r <- parse_exp
    ast.op2(op l r)
  parse_int = many1(satisfy("0123456789".has))?.join("")?.to_i
